---
classes:
  - "profile::core::icinga_agent"

lookup_options:
  accounts::group_list:
    merge:
      strategy: "deep"
  accounts::user_list:
    merge:
      strategy: "deep"
  network::interfaces_hash:
    merge:
      strategy: "deep"
  sudo::configs:
    merge:
      strategy: "deep"
  sysctl::values::args:
    merge:
      strategy: "deep"
  yum::managed_repos:
    merge:
      strategy: "unique"
  yum::repos:
    merge:
      strategy: "deep"
  ccs_software::installations:
    merge:
      strategy: "deep"

timezone::timezone: "UTC"
chrony::leapsectz: "right/UTC"
ssh::storeconfigs_enabled: false
ssh::server_options:
  Port: 22
  Protocol: 2
  AddressFamily: "inet"
  HostKey:
    - "/etc/ssh/ssh_host_rsa_key"
    - "/etc/ssh/ssh_host_ecdsa_key"
    - "/etc/ssh/ssh_host_ed25519_key"
  SyslogFacility: "AUTH"
  LogLevel: "INFO"
  LoginGraceTime: 120
  PermitRootLogin: "without-password"
  PubkeyAuthentication: "yes"
  HostbasedAuthentication: "no"
  IgnoreUserKnownHosts: "no"
  IgnoreRhosts: "no"
  PasswordAuthentication: "no"
  ChallengeResponseAuthentication: "yes"
  GSSAPIAuthentication: "yes"
  GSSAPICleanupCredentials: "yes"
  UsePAM: "yes"
  AllowTcpForwarding: "yes"
  X11Forwarding: "yes"
  X11UseLocalhost: "yes"
  PrintMotd: "no"
  TCPKeepAlive: "yes"
  ClientAliveInterval: 0
  ClientAliveCountMax: 3
  UseDNS: "no"
  PermitTunnel: "no"
  Banner: "none"
  XAuthLocation: "/usr/bin/xauth"
  Subsystem: "sftp /usr/libexec/openssh/sftp-server"
  KerberosAuthentication: "no"
  AuthorizedKeysCommand: "/usr/bin/sss_ssh_authorizedkeys"
  AuthorizedKeysCommandUser: "nobody"

# easy_ipa server options
# defines the uid/gid of the admin user
# needs to be coordinated between master + replicas
easy_ipa::idstart: 70000
easy_ipa::idmax: 79999
easy_ipa::domain: "lsst.cloud"
easy_ipa::ipa_master_fqdn: "ipa1.tuc.lsst.cloud"
# easy_ipa client options
easy_ipa::ipa_role: "client"
easy_ipa::configure_ntp: false
easy_ipa::install_epel: false
easy_ipa::install_autofs: false
easy_ipa::install_sssdtools: false
easy_ipa::install_kstart: false
easy_ipa::configure_sshd: false
ssh::client_options:
  GlobalKnownHostsFile: "/var/lib/sss/pubconf/known_hosts"
  PubkeyAuthentication: "yes"
  ProxyCommand: "/usr/bin/sss_ssh_knownhostsproxy -p %p %h"

sudo::config_file_replace: false
sudo::purge: false
sudo::configs:
  wheel_b:  # backup wheel group in case of LDAP failure.
    content: "%wheel_b ALL=(ALL) NOPASSWD: ALL"

accounts::group_list:
  wheel_b: {}
accounts::user_defaults:
  managehome: true
  system: false
  managevim: false
accounts::user_list:
  root:
    password: "%{root_pw}"
  jhoblitt_b:  # backup access in case LDAP fails
    groups:
      - "wheel_b"
    sshkeys:
      - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDZFV9AL2qPh6CV+DeY32oyg0jCkxkbCHVSPHOoikDkwzwMW/7QQdRI8TJ0h8vpFi15pNyu+n7s7MJSWdg5yUvTCataVpOndDElDz10DaEcGIHNq8/qjEPiHulj/KUoDkEU+yMoWY8jRs3ARyL+6p6LDUBsWpzIY8jMOaEVUJjlVt+0ih2a/D3re0daws6w3mBbmLjitHLS5f2YJKlStIHWCWjMXvP5tqUsvhHvIQH/csBQGXnUiRxR8YSJK9u3CMvTzx6PnC7p98yRCOOrMRQ7yT7vuXyXsk7qoUpArUe/T5nEcwRA/21QVurJ1s3in/mpFI0Ogg5kD7NpFqoTq6itBxbPz7DwaOyjEltJBjQAEvuvfHDJYsBTM3fpfEt5jR8ieuDta1214tr5qVOmR17JonssV7/ksizATm1KkMA7+Q8CWCgrFdZmEMaFjav2U72EWyLRe5utxQV+dWPnxd13NxVu6sgM3CBEC4HzOBMf+upt8tMvjLBjci1sbhCAvvU= github2"
  hreinking_b:  # backup access in case LDAP fails
    groups:
      - "wheel_b"
    sshkeys:
      - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCn8ssc5uxsHRdhvykrrQWiDMLzpjH/GC2011SyQBpBS43grDpxpGXXSL28LTMRxw3TZhAL4F1szLWR0O7kmKwTcK5OyF/7X/qvZ+w8ZtOxIU/FsSWEXbG2wrkX7fT+SvF/1WS97cu/EacjmFdQUQyYwPcF3MvmBMp3Hk1eSgJA97I7dUiUJjPda2iNFCnaTW9yJIUYfBPvXeO2FePzCUp8ImBZSkst/VLMTrTQ9DFB+Aj0E8npet8JFn2pUxG198yS2MH7tr3s9XKCUcpUXqySQNwIbtNsEKXljpxpQ3ftcaxo3fw0tgjdBr5BDjrBXbVsw+eVz3vwT7GvGHCGTeDP hreinking@NBB40230-1-A.local"
  lssttech: &rm_user
    ensure: "absent"
    managehome: true
    purge_user_home: true
  sysadmin:
    <<: *rm_user
  athebo:
    <<: *rm_user
  athebo_b:
    <<: *rm_user

tuned::profile: "latency-performance"
selinux::mode: "disabled"
firewall::ensure: "stopped"
puppet_agent::package_version: "6.7.0"
puppet_agent::collection: "puppet6"

# Rsyslog configuration is based on the default rsyslog.conf shipping with CentOS 7.7
rsyslog::config::global_config:
  workDirectory:
    value: "/var/lib/rsyslog"
  maxMessageSize:
    value: "64k"
  preserveFQDN:
    value: "on"
rsyslog::config::modules:
  imuxsock: {}
  imjournal:
    config:
      StateFile: "imjournal.state"
      IgnorePreviousMessages: "off"
      Ratelimit.Interval: 600
      Ratelimit.Burst: 20000
  imklog: {}
  immark: {}
  imfile: {}

rsyslog::config::actions:
  # Log anything (except mail) of level info or higher.
  # Don't log private authentication messages!
  #
  # local6 is used for logs that should only be forwarded to a central log
  # server and should never be stored locally. See IT-1734.
  messages:
    type: "omfile"
    facility: "*.info;mail.none;authpriv.none;cron.none;local6.none"
    config:
      file: "/var/log/messages"
  # The authpriv file has restricted access.
  secure:
    type: "omfile"
    facility: "authpriv.*"
    config:
      file: "/var/log/secure"
  # Everybody gets emergency messages
  emerg:
    type: "omusrmsg"
    facility: "*.emerg"
    config:
      users: "*"
  maillog:
    type: "omfile"
    facility: "mail.*"
    config:
      file: "-/var/log/maillog"
  cron:
    type: "omfile"
    facility: "cron.*"
    config:
      file: "/var/log/cron"
  # local7 does not appear to be used by CentOS 7, but for the sake of
  # consistency we preserve it to match the CentOS configuration.
  boot:
    type: "omfile"
    facility: "local7.*"
    config:
      file: "-/var/log/boot.log"

yum::plugin::versionlock:
  # trigger `yum clean all`
  clean: true

letsencrypt::email: "rubinobs-it-las@lsst.org"
profile::core::icinga_agent::install: true
profile::core::icinga_agent::host_template: "GeneralHostTemplate"
profile::core::icinga_agent::icinga_master_fqdn: "icinga-master.ls.lsst.org"
profile::core::icinga_agent::icinga_master_ip: "139.229.135.31"
