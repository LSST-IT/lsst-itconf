---
classes:
  - "clustershell"
  - "easy_ipa"
  - "profile::core::common"
  - "profile::core::ipa_pwd_reset"
  - "tailscale"

profile::core::common::disable_ipv6: true
profile::core::common::manage_ipa: false
profile::core::common::manage_krb5: false
profile::core::common::manage_sssd: false
profile::core::sysctl::disable_ipv6::disable: false  # ipa-server-install wants ipv6
easy_ipa::ipa_role: "replica"
easy_ipa::configure_replica_ca: true
easy_ipa::install_ipa_server: true
easy_ipa::enable_ip_address: true
easy_ipa::webui_disable_kerberos: true
easy_ipa::webui_enable_proxy: true
easy_ipa::webui_force_https: true
easy_ipa::configure_dns_server: false
easy_ipa::ipa_server_fqdn: "%{facts.fqdn}"
easy_ipa::ip_address: "%{facts.networking.ip}"

# enable easy_ipa management of sssd packages on servers
easy_ipa::install_sssd: true
easy_ipa::install_sssdtools: true

clustershell::groupmembers:
  ipa:
    group: "ipa"
    member:
      - "ipa[1-3].cp.lsst.org"
      - "ipa[1-3].ls.lsst.org"
      - "ipa[1-3].tu.lsst.org"
      - "ipa1.dev.lsst.org"

profile::core::ipa_pwd_reset::ldap_user: "ldap-passwd-reset"
profile::core::yum::versionlock:
  389-ds-base:
    ensure: "present"
    version: "1.3.10.2"
    release: "17.el7_9"
  389-ds-base-libs:
    ensure: "present"
    version: "1.3.10.2"
    release: "17.el7_9"

tailscale::up_options:
  accept-dns: false  # leave /etc/resolv.conf alone
  hostname: "%{facts.fqdn}"  # use fqdn instead of short hostname

hosts::host_entries:
  ipa1.dev.lsst.org:
    ip: "100.112.180.100"
  ipa2.dev.lsst.org:
    ip: "100.71.133.15"
  ipa1.tu.lsst.org:
    ip: "100.107.132.55"
  ipa2.tu.lsst.org:
    ip: "100.127.11.142"
  ipa3.tu.lsst.org:
    ip: "100.87.197.47"
  ipa1.ls.lsst.org:
    ip: "100.78.115.42"
  ipa2.ls.lsst.org:
    ip: "100.81.221.120"
  ipa3.ls.lsst.org:
    ip: "100.80.142.127"
  ipa1.cp.lsst.org:
    ip: "100.97.236.28"
  ipa2.cp.lsst.org:
    ip: "100.91.143.57"
  ipa3.cp.lsst.org:
    ip: "100.94.76.56"
